{"uid":"27fdf0275a75d833","name":"test_api_requests[case2]","fullName":"testcase.test_drugService.TestUserAPI#test_api_requests","historyId":"36f1287e6b6b998c6ac7828992f496c1","time":{"start":1747990774354,"stop":1747990774576,"duration":222},"status":"broken","statusMessage":"KeyError: 'expect'","statusTrace":"self = <test_drugService.TestUserAPI object at 0x000001F22EABB310>\ncase = {'name': '特非那定片精确搜索', 'request': {'Content-Type': 'application/json; charset=utf-8', 'body': {'page': 1, 'size': 10, '... 'string'}, 'price': {'minimum': 0, 'type': 'number'}, 'spec': {'minLength': 1, 'type': 'string'}}], 'resultCode': 0}}}\n\n    @allure.story(\"验证模糊查询\")\n    @pytest.mark.parametrize(\"case\", pytest.api_test_data)\n    def test_api_requests(self, case):\n        logger.info(f\"执行用例 %s \"% case['name'])\n        # logger.info(f'路径 {case[\"request\"][\"url\"]}')\n        # logger.info(f'请求头 {case[\"request\"][\"headers\"]}')\n        # 发送请求并获取响应\n        response = client.post(\n        endpoint = case[\"request\"][\"url\"],\n        data = case[\"request\"][\"headers\"],\n        json = case[\"request\"][\"body\"]\n        )\n        response_data = response.json()\n        # 第一层：基础HTTP验证\n        # assert response.status_code == case['expect']['status_code']\n        assert response.status_code == 200\n        # # 第二层：JSON Schema验证\n        # response_data = response.json()\n        # validate(instance=response_data, schema=RESPONSE_SCHEMA)\n        # 第三层：关键字断言\n>       if 'response_contains' in case['expect']:\nE       KeyError: 'expect'\n\ntestcase\\test_drugService.py:52: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"broken","statusMessage":"KeyError: 'expect'","statusTrace":"self = <test_drugService.TestUserAPI object at 0x000001F22EABB310>\ncase = {'name': '特非那定片精确搜索', 'request': {'Content-Type': 'application/json; charset=utf-8', 'body': {'page': 1, 'size': 10, '... 'string'}, 'price': {'minimum': 0, 'type': 'number'}, 'spec': {'minLength': 1, 'type': 'string'}}], 'resultCode': 0}}}\n\n    @allure.story(\"验证模糊查询\")\n    @pytest.mark.parametrize(\"case\", pytest.api_test_data)\n    def test_api_requests(self, case):\n        logger.info(f\"执行用例 %s \"% case['name'])\n        # logger.info(f'路径 {case[\"request\"][\"url\"]}')\n        # logger.info(f'请求头 {case[\"request\"][\"headers\"]}')\n        # 发送请求并获取响应\n        response = client.post(\n        endpoint = case[\"request\"][\"url\"],\n        data = case[\"request\"][\"headers\"],\n        json = case[\"request\"][\"body\"]\n        )\n        response_data = response.json()\n        # 第一层：基础HTTP验证\n        # assert response.status_code == case['expect']['status_code']\n        assert response.status_code == 200\n        # # 第二层：JSON Schema验证\n        # response_data = response.json()\n        # validate(instance=response_data, schema=RESPONSE_SCHEMA)\n        # 第三层：关键字断言\n>       if 'response_contains' in case['expect']:\nE       KeyError: 'expect'\n\ntestcase\\test_drugService.py:52: KeyError","steps":[{"name":"发送POST请求","time":{"start":1747990774359,"stop":1747990774576,"duration":217},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"endpoint","value":"'https://171.cdfortis.com/drugService/pharm/searchDrug'"},{"name":"data","value":"None"},{"name":"json","value":"{'text': '特非那定片', 'page': 1, 'size': 10}"}],"stepsCount":0,"attachmentStep":false,"hasContent":true,"shouldDisplayMessage":false,"attachmentsCount":0}],"attachments":[{"uid":"ea35dfb8868d1e5b","name":"log","source":"ea35dfb8868d1e5b.txt","type":"text/plain","size":863}],"parameters":[],"stepsCount":1,"attachmentStep":false,"hasContent":true,"shouldDisplayMessage":true,"attachmentsCount":1},"afterStages":[],"labels":[{"name":"story","value":"验证模糊查询"},{"name":"parentSuite","value":"testcase"},{"name":"suite","value":"test_drugService"},{"name":"subSuite","value":"TestUserAPI"},{"name":"host","value":"DESKTOP-SSNPUQJ"},{"name":"thread","value":"9892-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcase.test_drugService"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"case","value":"{'name': '特非那定片精确搜索', 'request': {'url': 'https://171.cdfortis.com/drugService/pharm/searchDrug', 'method': 'POST', 'headers': None, 'Content-Type': 'application/json; charset=utf-8', 'body': {'text': '特非那定片', 'page': 1, 'size': 10}}, 'response': {'schema': {'resultCode': 0, 'result': [{'commonName': {'type': 'string', 'pattern': '^[一-龥]+$'}, 'spec': {'type': 'string', 'minLength': 1}, 'price': {'type': 'number', 'minimum': 0}}]}, 'examples': [{'resultCode': 0, 'result': [{'commonName': '特非那定片', 'spec': '60毫克*12片', 'price': 4.6, 'companyName': '江苏联环药业股份有限公司'}], 'msg': 'success'}]}}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":[]},"source":"27fdf0275a75d833.json","parameterValues":["{'name': '特非那定片精确搜索', 'request': {'url': 'https://171.cdfortis.com/drugService/pharm/searchDrug', 'method': 'POST', 'headers': None, 'Content-Type': 'application/json; charset=utf-8', 'body': {'text': '特非那定片', 'page': 1, 'size': 10}}, 'response': {'schema': {'resultCode': 0, 'result': [{'commonName': {'type': 'string', 'pattern': '^[一-龥]+$'}, 'spec': {'type': 'string', 'minLength': 1}, 'price': {'type': 'number', 'minimum': 0}}]}, 'examples': [{'resultCode': 0, 'result': [{'commonName': '特非那定片', 'spec': '60毫克*12片', 'price': 4.6, 'companyName': '江苏联环药业股份有限公司'}], 'msg': 'success'}]}}"]}